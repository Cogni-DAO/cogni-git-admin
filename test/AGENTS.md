# Test Infrastructure

Testing framework and utilities for the Cogni Git Admin application.

## Directory Structure
```
test/
├─ fixtures/              # Sample webhook payloads  
│  └─ issues.opened.json  # GitHub issue opened event fixture
├─ helpers/               # Test utility modules
│  └─ fixture-replay.ts   # Webhook fixture replay functionality
└─ index.test.ts          # Main test suite
```

## Test Helpers

### Fixture Replay (`helpers/fixture-replay.ts`)
Replays captured webhook fixtures against running servers:
- Reads fixture files containing raw webhook data
- Reconstructs exact HTTP requests from captured metadata
- Sends replayed webhooks to specified target URLs
- Preserves original headers and raw body bytes
- Returns HTTP status code for verification

#### Fixture Format Expected
```typescript
{
  headers: Record<string, string | string[]>;
  body_raw_base64: string;  // Base64-encoded raw bytes
  method: string;            // HTTP method
  url: string;               // Original request path
}
```

## Testing Workflow
1. Capture real webhooks using `tools/dev/webhook-capture/`
2. Store fixtures in `fixtures/` directory organized by provider
3. Use `fixture-replay.ts` to replay webhooks in tests
4. Verify application behavior with deterministic inputs

## Integration with Capture System
Test fixtures are generated by the webhook capture tool and organized in:
- `fixtures/alchemy/`: Alchemy blockchain webhook fixtures
- `fixtures/github/`: GitHub webhook fixtures  
- `fixtures/unknown/`: Unidentified webhook fixtures